var CanvasControl=function(){var e=this,l={backgroundColor:"#000000"},t=0;this.defaultColor="#000000",this.defaultLineWidth="1",this.canvasContext=null,this.canvasObject=null,this.canvasObjects=[],Math.TAU=2*Math.PI,this.debug={_version:function(){return"1.20180113.7"}(),setLevel:function(e){return t=e,!0},getLevel:function(){return t},toggle:function(l){var i=e.debug.getToggleConst[l];i>-1?(t=t&e.debug.getToggleConst[l]?t-e.debug.getToggleConst[l]:t+e.debug.getToggleConst[l],console.log("Set ",l," to ",t)):(console.warn("No debug label ",l," exists. Try one of:"),console.warn(e.debug.getToggleConst))},getToggleConst:{setupCanvas:1,renderObjects:2,drawRect:4,drawText:8,drawArc:16,drawLine:32,drawPolygon:64,drawImage:128,clearCanvas:256,refreshScreen:512,mouseEventHandler:1024,checkMouseCollision:2048}},this.setupCanvas=function(e,i,n){return i=null==i?this.canvasObjects:i,n&&(l=n),this.canvasObject=e,i=[],i.push(),this.canvasObjects=i,this.canvasContext=e.getContext("2d"),1&t&&(console.log("[1]: Debug Mode is set to: ",t),console.log("[1]: setupCanvas(objCanvas, objectList): ",e,i)),this.canvasContext},this.renderObjects=function(e){return e=e?e:this.canvasObjects,e.forEach(function(e){null!=e.visible&&0!=e.visible&&e.render(e)}),2&t&&console.log("[2]: renderObjects(objectList): ",e),!0},this.renderObjectsSync=function(e){e=e?e:this.canvasObjects;for(canvasObject in e)void 0!==e[canvasObject].visible&&null!=e[canvasObject].visible&&0!=e[canvasObject].visible&&e[canvasObject].render(e[canvasObject]);return 2&t&&console.log("[2]: renderObjects(objectList): ",e),!0},this.drawRect=function(e,l,i,n,o,s,a){s=s?s:this.canvasContext,e=null==e||""===e?0:e,l=null==l||""===l?0:l,i=null==i||""===i?0:i,n=null==n||""===n?0:n,originalFillStyle=s.fillStyle,originalStrokeStyle=s.strokeStyle,null!=a&&(a.fillStyle=void 0===a.fillStyle?this.defaultColor:a.fillStyle,a.strokeStyle=void 0===a.strokeStyle?this.defaultColor:a.strokeStyle,a.lineWidth=void 0===a.lineWidth?this.defaultLineWidth:a.lineWidth),o=void 0===o||null==o?function(){s.stroke()}:o,null!=a&&(s.fillStyle=null==a.fillStyle?s.fillStyle:a.fillStyle,s.strokeStyle=null==a.strokeStyle?s.strokeStyle:a.strokeStyle,s.lineWidth=null==a.lineWidth?s.lineWidth:a.lineWidth),s.beginPath(),s.rect(e,l,i,n),o(),s.closePath(),s.fillStyle=originalFillStyle,s.strokeStyle=originalStrokeStyle,4&t&&console.log("[4]: drawRect(x, y, w, h, renderType, context, style): ",e,l,i,n,o,s,a)},this.drawText=function(e,l,i,n,o,s,a){s=s?s:this.canvasContext,e=null==e||""===e?0:e,l=null==l||""===l?0:l,n.w=null==n.w||""===n.w?s.measureText(i).width:n.w,n.h=null==n.h||""===n.h?s.measureText(i).height:n.h,originalFillStyle=s.fillStyle,originalStrokeStyle=s.strokeStyle,null!=a?(s.fillStyle=null==a.fillStyle?s.fillStyle:a.fillStyle,s.strokeStyle=null==a.strokeStyle?s.strokeStyle:a.strokeStyle,a.textBaseline=void 0===a.textBaseline?"hanging":a.textBaseline,a.font=void 0===a.font?"":a.font,a.maxWidth=void 0===a.maxWidth?null:a.maxWidth):a={},o=null==o?function(e,l,t,i){s.fillText(t,e,l)}:o,null!=a&&(s.fillStyle=null==a.fillStyle?s.fillStyle:a.fillStyle,s.strokeStyle=null==a.strokeStyle?s.strokeStyle:a.strokeStyle,s.textBaseline=void 0===a.textBaseline?s.textBaseline:a.textBaseline,s.font=void 0===a.font?s.font:a.font,a.maxWidth=void 0===a.maxWidth?s.maxWidth:a.maxWidth),s.beginPath(),o(e,l,i,a.maxWidth),s.closePath(),s.fillStyle=originalFillStyle,s.strokeStyle=originalStrokeStyle,8&t&&console.log("[8]: drawText(x, y, text, renderText, context, style): ",e,l,i,o,s,a)},this.drawArc=function(e,l,i,n,o,s,a,r){a=a?a:this.canvasContext,e=null==e||""===e?0:e,l=null==l||""===l?0:l,n=null==n||""===n?0:n,i=null==i||""===i?0:i,o=null==o||""===o?2*Math.TAU:o,originalFillStyle=a.fillStyle,originalStrokeStyle=a.strokeStyle,void 0!==r&&null!=r&&(r.fillStyle=void 0===r.fillStyle?this.defaultColor:r.fillStyle,r.strokeStyle=void 0===r.strokeStyle?this.defaultColor:r.strokeStyle,r.lineWidth=void 0===r.lineWidth?this.defaultLineWidth:r.lineWidth),s=null==s?function(){a.stroke()}:s,null!=r&&(a.fillStyle=null==r.fillStyle?a.fillStyle:r.fillStyle,a.strokeStyle=null==r.strokeStyle?a.strokeStyle:r.strokeStyle,a.lineWidth=null==r.lineWidth?a.lineWidth:r.lineWidth),a.beginPath(),a.arc(e,l,i,n,o),s(),a.closePath(),a.fillStyle=originalFillStyle,a.strokeStyle=originalStrokeStyle,16&t&&console.log("[16]: drawArc(x, y, r, s, f, renderType, context, style): ",e,l,i,n,o,s,a,r)},this.drawLine=function(e,l,i,n,o,s){o=o?o:this.canvasContext,e=null==e||""===e?0:e,l=null==l||""===l?0:l,i=null==i||""===i?0:i,n=null==n||""===n?0:n,originalFillStyle=o.fillStyle,originalStrokeStyle=o.strokeStyle,void 0!==s&&null!=s&&(s.strokeStyle=void 0===s.strokeStyle?this.defaultColor:s.strokeStyle,s.lineWidth=void 0===s.lineWidth?this.defaultLineWidth:s.lineWidth),void 0!==s&&null!=s&&(o.strokeStyle=null==s.strokeStyle?o.strokeStyle:s.strokeStyle,o.lineWidth=null==s.lineWidth?o.lineWidth:s.lineWidth),o.beginPath(),o.moveTo(e,l),o.lineTo(i,n),o.stroke(),o.closePath(),o.fillStyle=originalFillStyle,o.strokeStyle=originalStrokeStyle,32&t&&console.log("[32]: drawLine(x1, y1, x2, y2, context, style): ",e,l,i,n,o,s)},this.drawPolygon=function(e,l,n,o,s){if(o=o?o:this.canvasContext,l=null==l||""===l?!0:l,originalFillStyle=o.fillStyle,originalStrokeStyle=o.strokeStyle,null!=s&&(s.fillStyle=void 0===s.fillStyle?this.defaultColor:s.fillStyle,s.strokeStyle=void 0===s.strokeStyle?this.defaultColor:s.strokeStyle,s.lineWidth=void 0===s.lineWidth?this.defaultLineWidth:s.lineWidth),n=null==n?function(){o.stroke()}:n,null!=s&&(o.fillStyle=null==s.fillStyle?o.fillStyle:s.fillStyle,o.strokeStyle=null==s.strokeStyle?o.strokeStyle:s.strokeStyle,o.lineWidth=null==s.lineWidth?o.lineWidth:s.lineWidth),l&&(e=i(e)),o.beginPath(),e.length>0){o.moveTo(e[0][0],e[0][1]);for(var a=1;a<e.length;a++)o.lineTo(e[a][0],e[a][1])}o.closePath(),n(),o.fillStyle=originalFillStyle,o.strokeStyle=originalStrokeStyle,64&t&&console.log("[64]: drawPolygon(polygonPoints, autoArrange, renderType, context, style): ",e,l,n,o,s)},this.drawImage=function(e,l,i,n,o,s,a,r,c,d){d=d?d:this.canvasContext,l=null==l||""===l?0:l,i=null==i||""===i?0:i,n=void 0===n?e.width:n,o=void 0===o?e.height:o,s=void 0===o?null:s,a=void 0===o?null:a,r=void 0===o?null:r,c=void 0===o?null:c,originalFillStyle=d.fillStyle,e.objImage&&(e.w=e.w<0?e.objImage.width:e.w,e.h=e.h<0?e.objImage.height:e.h,d.beginPath(),null===s||null===a||null===r||null===c||0===s||0===a||0===r||0===c?0>n||0>o?d.drawImage(e.objImage,l,i):d.drawImage(e.objImage,l,i,n,o):d.drawImage(e.objImage,s,a,r,c,l,i,n,o),d.closePath(),e.onload=function(){e.hasLoaded=!0,e.w=e.w<0?e.objImage.width:e.w,e.h=e.h<0?e.objImage.height:e.h,d.beginPath(),null===s||null===a||null===r||null===c||0===s||0===a||0===r||0===c?0>n||0>o?d.drawImage(e.objImage,l,i):d.drawImage(e.objImage,l,i,n,o):d.drawImage(e.objImage,s,a,r,c,l,i,n,o),d.closePath()}),d.fillStyle=originalFillStyle,128&t&&console.log("[128]: drawImage(srcImage, x, y, w, h, sx, sy, sw, sh, context): ",e,l,i,n,o,s,a,r,c,d)},this.clearCanvas=function(e,i,n){i=i?i:this.canvasContext,n=void 0===n||null==n?!0:n,originalFillStyle=i.fillStyle,e=void 0!==l&&null!=l?void 0===e||null==e?l.backgroundColor:e:void 0===e||null==e?"#FFFFFF":e,n?i.clearRect(0,0,this.canvasObject.width,this.canvasObject.height):this.drawRect(0,0,this.canvasObject.width,this.canvasObject.height,function(){i.fill()},i,{fillStyle:e}),i.fillStyle=originalFillStyle,256&t&&console.log("[256]: clearCanvas(backgroundColor, context, transparentBackground): ",e,i,n)},this.refreshScreen=function(e,l,i){l=l?l:this.canvasContext,i=i?i:this.canvasObjects,this.clearCanvas(null,l,e),this.renderObjects(i),512&t&&console.log("[512]: refreshScreen(transparentBackground, context, objectList): ",e,l,i)},this.mouseEventHandler=function(e,l,i){i=i?i:this.canvasObjects;triggedObjectList=this.checkMouseCollision(e.offsetX,e.offsetY),triggedObjectList.forEach(function(t){"Click"===l?"function"==typeof t.clickEvent&&(null!=t.enabled?t.enabled===!0&&t.clickEvent(e.offsetX,e.offsetY,t):t.clickEvent(e.offsetX,e.offsetY,t)):"Move"==l&&"function"==typeof t.moveEvent&&(null!=t.enabled?t.enabled===!0&&t.moveEvent(e.offsetX,e.offsetY,t):t.moveEvent(e.offsetX,e.offsetY,t))}),1024&t&&console.log("[1024]: mouseEventHandler(e, eventType, objectList): ",e,l,i)},this.mouseEventHandlerSync=function(e,l,i){i=void 0===i||null==i?this.canvasObjects:i;triggedObjectList=this.checkMouseCollision(e.offsetX,e.offsetY);for(var n in triggedObjectList)null!=triggedObjectList[n]&&("Click"==l?void 0!==triggedObjectList[n].clickEvent&&null!=triggedObjectList[n].clickEvent&&(void 0!==triggedObjectList[n].enabled&&null!=triggedObjectList[n].enabled?1==triggedObjectList[n].enabled&&triggedObjectList[n].clickEvent(e.offsetX,e.offsetY,triggedObjectList[n]):triggedObjectList[n].clickEvent(e.offsetX,e.offsetY,triggedObjectList[n])):"Move"==l&&void 0!==triggedObjectList[n].moveEvent&&null!=triggedObjectList[n].moveEvent&&(void 0!==triggedObjectList[n].enabled&&null!=triggedObjectList[n].enabled?1==triggedObjectList[n].enabled&&triggedObjectList[n].moveEvent(e.offsetX,e.offsetY,triggedObjectList[n]):triggedObjectList[n].moveEvent(e.offsetX,e.offsetY,triggedObjectList[n])));1024&t&&console.log("[1024]: mouseEventHandlerSync(e, eventType, objectList): ",e,l,i)},this.checkMouseCollision=function(e,l,i){return i=i?i:this.canvasObjects,clickedObjects=[],i.forEach(function(t){if(null!=t&&null!==t.shape)switch(t.shape){case"rect":null!==t.x&&null!==t.w&&null!==t.y&&null!==t.h&&t.x<=e&&t.x+t.w>=e&&t.y<=l&&t.y+t.h>=l&&clickedObjects.push(t);break;case"arc":null!=t.x&&null!=t.y&&null!=t.r&&Math.sqrt((e-t.x)*(e-t.x)+(l-t.y)*(l-t.y))<t.r&&clickedObjects.push(t);break;case"image":null!==t.x&&null!==t.w&&null!==t.y&&null!==t.h&&t.x<=e&&t.x+t.w>=e&&t.y<=l&&t.y+t.h>=l&&clickedObjects.push(t);break;case"text":null!==t.x&&null!==t.w&&null!==t.y&&null!==t.h&&t.x<=e&&t.x+t.w>=e&&t.y<=l&&t.y+t.h>=l&&clickedObjects.push(t);break;case"polygon":for(var i=t.coordinates[0],n=!1,o=0,s=i.length-1;o<i.length;s=o++){var a=i[o][0],r=i[o][1],c=i[s][0],d=i[s][1],u=r>l!=d>l&&(c-a)*(l-r)/(d-r)+a>e;u&&(n=!n)}n&&clickedObjects.push(t)}}),2048&t&&console.log("[2048]: checkMouseCollision(mouseX, mouseY, objectList): ",e,l,i),clickedObjects},this.checkMouseCollisionSync=function(e,l,i){i=void 0===i||null==i?this.canvasObjects:i,clickedObjects=[];for(var n in i)if(null!=i[n]&&void 0!==typeof i[n]&&null!=i[n].shape&&void 0!==typeof i[n].shape)if("rect"==i[n].shape)void 0!==i[n].x&&null!=i[n].x&&void 0!==i[n].w&&null!=i[n].w&&void 0!==i[n].y&&null!=i[n].y&&void 0!==i[n].h&&null!=i[n].h&&i[n].x<=e&&i[n].x+i[n].w>=e&&i[n].y<=l&&i[n].y+i[n].h>=l&&clickedObjects.push(i[n]);else if("arc"===i[n].shape)void 0!==i[n].x&&null!=i[n].x&&void 0!==i[n].y&&null!=i[n].y&&void 0!==i[n].r&&null!=i[n].r&&Math.sqrt((e-i[n].x)*(e-i[n].x)+(l-i[n].y)*(l-i[n].y))<i[n].r&&clickedObjects.push(i[n]);else if("image"===i[n].shape)void 0!==i[n].x&&null!=i[n].x&&void 0!==i[n].w&&null!=i[n].w&&void 0!==i[n].y&&null!=i[n].y&&void 0!==i[n].h&&null!=i[n].h&&i[n].x<=e&&i[n].x+i[n].w>=e&&i[n].y<=l&&i[n].y+i[n].h>=l&&clickedObjects.push(i[n]);else if("text"===i[n].shape)void 0!==i[n].x&&null!=i[n].x&&void 0!==i[n].w&&null!=i[n].w&&void 0!==i[n].y&&null!=i[n].y&&void 0!==i[n].h&&null!=i[n].h&&i[n].x<=e&&i[n].x+i[n].w>=e&&i[n].y<=l&&i[n].y+i[n].h>=l&&clickedObjects.push(i[n]);else if("polygon"===i[n].shape){for(var o=i[n].coordinates[0],s=!1,a=0,r=o.length-1;a<o.length;r=a++){var c=o[a][0],d=o[a][1],u=o[r][0],h=o[r][1],f=d>l!=h>l&&(u-c)*(l-d)/(h-d)+c>e;f&&(s=!s)}s&&clickedObjects.push(i[n])}return 2048&t&&console.log("[2048]: checkMouseCollisionAsync(mouseX, mouseY, objectList): ",e,l,i),clickedObjects};var i=function(e){e=e.slice(0);for(var l=function(e){for(var l=0,t=0,i=0;i<e.length;i++)l+=e[i][0],t+=e[i][1];return[l/e.length,t/e.length]},t=l(e),i=0;i<e.length;i++)e[i][2]=Math.atan2(e[i][0]-t[0],e[i][1]-t[1]);e=e.sort(function(e,l){return e[2]-l[2]});var n=[];if(e.forEach(function(e){n.indexOf(e)<0&&n.push(e)}),n.length>0){(n[n.length-1][0]!==n[0][0]||n[n.length-1][1]!==n[0][1])&&n.push([n[0][0],n[0][1]]);for(var o=0;o<n.length;o++)n[o]=[n[o][0],n[o][1]]}return n}};"undefined"!=typeof module?module.exports=CanvasControl:"function"==typeof define&&define.amd&&define([],function(){"use strict";return CanvasControl});