var CanvasControl=function(){defaultBackgroundObject={backgroundColor:"#000000"};var a=0;this.defaultColor="#000000",this.defaultLineWidth="1",this.canvasContext=null,this.canvasObject=null,this.canvasObjects=[],Math.TAU=2*Math.PI,this.setDebugState=function(b){return a=b,!0},this.setupCanvas=function(b,c,d){return c=void 0===c||null==c?this.canvasObjects:c,d&&(defaultBackgroundObject=d),this.canvasObject=b,c=[],c.push(),this.canvasObjects=c,this.canvasContext=b.getContext("2d"),1&a&&(console.log("[1]: Debug Mode is set to: ",a),console.log("[1]: setupCanvas(objCanvas, objectList): ",b,c)),this.canvasContext},this.renderObjects=function(b){b=void 0===b||null==b?this.canvasObjects:b;for(canvasObject in b)void 0!==b[canvasObject].visible&&null!=b[canvasObject].visible&&0!=b[canvasObject].visible&&b[canvasObject].render(b[canvasObject]);return 2&a&&console.log("[2]: renderObjects(objectList): ",b),!0},this.drawRect=function(b,c,d,e,f,g,h){g=void 0===g||null==g?this.canvasContext:g,b=void 0===b||null==b||""==b?0:b,c=void 0===c||null==c||""==c?0:c,d=void 0===d||null==d||""==d?0:d,e=void 0===e||null==e||""==e?0:e,originalFillStyle=g.fillStyle,originalStrokeStyle=g.strokeStyle,void 0!==h&&null!=h&&(h.fillStyle=void 0===h.fillStyle?this.defaultColor:h.fillStyle,h.strokeStyle=void 0===h.strokeStyle?this.defaultColor:h.strokeStyle,h.lineWidth=void 0===h.lineWidth?this.defaultLineWidth:h.lineWidth),f=void 0===f||null==f?function(){g.stroke()}:f,void 0!==h&&null!=h&&(g.fillStyle=void 0===h.fillStyle||null==h.fillStyle?g.fillStyle:h.fillStyle,g.strokeStyle=void 0===h.strokeStyle||null==h.strokeStyle?g.strokeStyle:h.strokeStyle,g.lineWidth=void 0===h.lineWidth||null==h.lineWidth?g.lineWidth:h.lineWidth),g.beginPath(),g.rect(b,c,d,e),f(),g.closePath(),g.fillStyle=originalFillStyle,g.strokeStyle=originalStrokeStyle,4&a&&console.log("[4]: drawRect(x, y, w, h, renderType, context, style): ",b,c,d,e,f,g,h)},this.drawText=function(b,c,d,e,f,g,h){g=void 0===g||null==g?this.canvasContext:g,b=void 0===b||null==b||""==b?0:b,c=void 0===c||null==c||""==c?0:c,e.w=void 0===e.w||null==e.w||""==e.w?g.measureText(d).width:e.w,e.h=void 0===e.h||null==e.h||""==e.h?g.measureText(d).height:e.h,originalFillStyle=g.fillStyle,originalStrokeStyle=g.strokeStyle,void 0!==h&&null!=h?(g.fillStyle=void 0===h.fillStyle||null==h.fillStyle?g.fillStyle:h.fillStyle,g.strokeStyle=void 0===h.strokeStyle||null==h.strokeStyle?g.strokeStyle:h.strokeStyle,h.textBaseline=void 0===h.textBaseline?"hanging":h.textBaseline,h.font=void 0===h.font?"":h.font,h.maxWidth=void 0===h.maxWidth?null:h.maxWidth):h={},f=void 0===f||null==f?function(a,b,c,d){g.fillText(c,a,b)}:f,void 0!==h&&null!=h&&(g.fillStyle=void 0===h.fillStyle||null==h.fillStyle?g.fillStyle:h.fillStyle,g.strokeStyle=void 0===h.strokeStyle||null==h.strokeStyle?g.strokeStyle:h.strokeStyle,g.textBaseline=void 0===h.textBaseline?g.textBaseline:h.textBaseline,g.font=void 0===h.font?g.font:h.font,h.maxWidth=void 0===h.maxWidth?g.maxWidth:h.maxWidth),g.beginPath(),f(b,c,d,h.maxWidth),g.closePath(),g.fillStyle=originalFillStyle,g.strokeStyle=originalStrokeStyle,8&a&&console.log("[8]: drawText(x, y, text, renderText, context, style): ",b,c,d,f,g,h)},this.drawArc=function(b,c,d,e,f,g,h,i){h=void 0===h||null==h?this.canvasContext:h,b=void 0===b||null==b||""==b?0:b,c=void 0===c||null==c||""==c?0:c,e=void 0===e||null==e||""==e?0:e,d=void 0===d||null==d||""==d?0:d,f=void 0===f||null==f||""==f?2*Math.TAU:f,originalFillStyle=h.fillStyle,originalStrokeStyle=h.strokeStyle,void 0!==i&&null!=i&&(i.fillStyle=void 0===i.fillStyle?this.defaultColor:i.fillStyle,i.strokeStyle=void 0===i.strokeStyle?this.defaultColor:i.strokeStyle,i.lineWidth=void 0===i.lineWidth?this.defaultLineWidth:i.lineWidth),g=void 0===g||null==g?function(){h.stroke()}:g,void 0!==i&&null!=i&&(h.fillStyle=void 0===i.fillStyle||null==i.fillStyle?h.fillStyle:i.fillStyle,h.strokeStyle=void 0===i.strokeStyle||null==i.strokeStyle?h.strokeStyle:i.strokeStyle,h.lineWidth=void 0===i.lineWidth||null==i.lineWidth?h.lineWidth:i.lineWidth),h.beginPath(),h.arc(b,c,d,e,f),g(),h.closePath(),h.fillStyle=originalFillStyle,h.strokeStyle=originalStrokeStyle,16&a&&console.log("[16]: drawArc(x, y, r, s, f, renderType, context, style): ",b,c,d,e,f,g,h,i)},this.drawLine=function(b,c,d,e,f,g){f=void 0===f||null==f?this.canvasContext:f,b=void 0===b||null==b||""==b?0:b,c=void 0===c||null==c||""==c?0:c,d=void 0===d||null==d||""==d?0:d,e=void 0===e||null==e||""==e?0:e,originalFillStyle=f.fillStyle,originalStrokeStyle=f.strokeStyle,void 0!==g&&null!=g&&(g.strokeStyle=void 0===g.strokeStyle?this.defaultColor:g.strokeStyle,g.lineWidth=void 0===g.lineWidth?this.defaultLineWidth:g.lineWidth),void 0!==g&&null!=g&&(f.strokeStyle=void 0===g.strokeStyle||null==g.strokeStyle?f.strokeStyle:g.strokeStyle,f.lineWidth=void 0===g.lineWidth||null==g.lineWidth?f.lineWidth:g.lineWidth),f.beginPath(),f.moveTo(b,c),f.lineTo(d,e),f.stroke(),f.closePath(),f.fillStyle=originalFillStyle,f.strokeStyle=originalStrokeStyle,32&a&&console.log("[32]: drawLine(x1, y1, x2, y2, context, style): ",b,c,d,e,f,g)},this.drawPolygon=function(c,d,e,f,g){if(f=void 0===f||null==f?this.canvasContext:f,d=void 0===d||null==d||""==d||d,originalFillStyle=f.fillStyle,originalStrokeStyle=f.strokeStyle,void 0!==g&&null!=g&&(g.fillStyle=void 0===g.fillStyle?this.defaultColor:g.fillStyle,g.strokeStyle=void 0===g.strokeStyle?this.defaultColor:g.strokeStyle,g.lineWidth=void 0===g.lineWidth?this.defaultLineWidth:g.lineWidth),e=void 0===e||null==e?function(){f.stroke()}:e,void 0!==g&&null!=g&&(f.fillStyle=void 0===g.fillStyle||null==g.fillStyle?f.fillStyle:g.fillStyle,f.strokeStyle=void 0===g.strokeStyle||null==g.strokeStyle?f.strokeStyle:g.strokeStyle,f.lineWidth=void 0===g.lineWidth||null==g.lineWidth?f.lineWidth:g.lineWidth),d&&(c=b(c)),f.beginPath(),c.length>0){f.moveTo(c[0][0],c[0][1]);for(var h=1;h<c.length;h++)f.lineTo(c[h][0],c[h][1])}f.closePath(),e(),f.fillStyle=originalFillStyle,f.strokeStyle=originalStrokeStyle,64&a&&console.log("[64]: drawPolygon(polygonPoints, autoArrange, renderType, context, style): ",c,d,e,f,g)},this.drawImage=function(b,c,d,e,f,g,h,i,j,k){k=void 0===k||null==k?this.canvasContext:k,c=void 0===c||null==c||""==c?0:c,d=void 0===d||null==d||""==d?0:d,e=void 0===e?b.width:e,f=void 0===f?b.height:f,g=void 0===f?null:g,h=void 0===f?null:h,i=void 0===f?null:i,j=void 0===f?null:j,originalFillStyle=k.fillStyle,b.objImage&&(b.w=b.w<0?b.objImage.width:b.w,b.h=b.h<0?b.objImage.height:b.h,k.beginPath(),null==g||null==h||null==i||null==j||0==g||0==h||0==i||0==j?e<0||f<0?k.drawImage(b.objImage,c,d):k.drawImage(b.objImage,c,d,e,f):k.drawImage(b.objImage,g,h,i,j,c,d,e,f),k.closePath(),b.onload=function(){b.hasLoaded=!0,b.w=b.w<0?b.objImage.width:b.w,b.h=b.h<0?b.objImage.height:b.h,k.beginPath(),null==g||null==h||null==i||null==j||0==g||0==h||0==i||0==j?e<0||f<0?k.drawImage(b.objImage,c,d):k.drawImage(b.objImage,c,d,e,f):k.drawImage(b.objImage,g,h,i,j,c,d,e,f),k.closePath()}),k.fillStyle=originalFillStyle,128&a&&console.log("[128]: drawImage(srcImage, x, y, w, h, sx, sy, sw, sh, context): ",b,c,d,e,f,g,h,i,j,k)},this.clearCanvas=function(b,c,d){c=void 0===c||null==c?this.canvasContext:c,d=void 0===d||null==d||d,originalFillStyle=c.fillStyle,b=void 0!==defaultBackgroundObject&&null!=defaultBackgroundObject?void 0===b||null==b?defaultBackgroundObject.backgroundColor:b:void 0===b||null==b?"#FFFFFF":b,d?c.clearRect(0,0,this.canvasObject.width,this.canvasObject.height):this.drawRect(0,0,this.canvasObject.width,this.canvasObject.height,function(){c.fill()},c,{fillStyle:b}),c.fillStyle=originalFillStyle,256&a&&console.log("[256]: clearCanvas(backgroundColor, context, transparentBackground): ",b,c,d)},this.refreshScreen=function(b,c,d){c=void 0===c||null==c?this.canvasContext:c,d=void 0===d||null==d?this.canvasObjects:d,this.clearCanvas(null,c,b),this.renderObjects(d),512&a&&console.log("[512]: refreshScreen(transparentBackground, context, objectList): ",b,c,d)},this.mouseEventHandler=function(b,c,d){d=void 0===d||null==d?this.canvasObjects:d;triggedObjectList=this.checkMouseCollision(b.offsetX,b.offsetY);for(var f in triggedObjectList)null!=triggedObjectList[f]&&("Click"==c?void 0!==triggedObjectList[f].clickEvent&&null!=triggedObjectList[f].clickEvent&&(void 0!==triggedObjectList[f].enabled&&null!=triggedObjectList[f].enabled?1==triggedObjectList[f].enabled&&triggedObjectList[f].clickEvent(b.offsetX,b.offsetY,triggedObjectList[f]):triggedObjectList[f].clickEvent(b.offsetX,b.offsetY,triggedObjectList[f])):"Move"==c&&void 0!==triggedObjectList[f].moveEvent&&null!=triggedObjectList[f].moveEvent&&(void 0!==triggedObjectList[f].enabled&&null!=triggedObjectList[f].enabled?1==triggedObjectList[f].enabled&&triggedObjectList[f].moveEvent(b.offsetX,b.offsetY,triggedObjectList[f]):triggedObjectList[f].moveEvent(b.offsetX,b.offsetY,triggedObjectList[f])));1024&a&&console.log("[1024]: mouseEventHandler(e, eventType, objectList): ",b,c,d)},this.checkMouseCollision=function(b,c,d){d=void 0===d||null==d?this.canvasObjects:d,clickedObjects=[];for(var e in d)if(null!=d[e]&&void 0!==typeof d[e]&&null!=d[e].shape&&void 0!==typeof d[e].shape)if("rect"==d[e].shape)void 0!==d[e].x&&null!=d[e].x&&void 0!==d[e].w&&null!=d[e].w&&void 0!==d[e].y&&null!=d[e].y&&void 0!==d[e].h&&null!=d[e].h&&d[e].x<=b&&d[e].x+d[e].w>=b&&d[e].y<=c&&d[e].y+d[e].h>=c&&clickedObjects.push(d[e]);else if("arc"==d[e].shape)void 0!==d[e].x&&null!=d[e].x&&void 0!==d[e].y&&null!=d[e].y&&void 0!==d[e].r&&null!=d[e].r&&Math.sqrt((b-d[e].x)*(b-d[e].x)+(c-d[e].y)*(c-d[e].y))<d[e].r&&clickedObjects.push(d[e]);else if("image"==d[e].shape)void 0!==d[e].x&&null!=d[e].x&&void 0!==d[e].w&&null!=d[e].w&&void 0!==d[e].y&&null!=d[e].y&&void 0!==d[e].h&&null!=d[e].h&&d[e].x<=b&&d[e].x+d[e].w>=b&&d[e].y<=c&&d[e].y+d[e].h>=c&&clickedObjects.push(d[e]);else if("text"==d[e].shape)void 0!==d[e].x&&null!=d[e].x&&void 0!==d[e].w&&null!=d[e].w&&void 0!==d[e].y&&null!=d[e].y&&void 0!==d[e].h&&null!=d[e].h&&d[e].x<=b&&d[e].x+d[e].w>=b&&d[e].y<=c&&d[e].y+d[e].h>=c&&clickedObjects.push(d[e]);else if("polygon"==d[e].shape){for(var f=d[e].coordinates[0],g=!1,h=0,i=f.length-1;h<f.length;i=h++){var j=f[h][0],k=f[h][1],l=f[i][0],m=f[i][1],n=k>c!=m>c&&b<(l-j)*(c-k)/(m-k)+j;n&&(g=!g)}g&&clickedObjects.push(d[e])}return 2048&a&&console.log("[2048]: checkMouseCollision(mouseX, mouseY, objectList): ",b,c,d),clickedObjects};var b=function(a){a=a.slice(0);for(var b=function(a){for(var b=0,c=0,d=0;d<a.length;d++)b+=a[d][0],c+=a[d][1];return[b/a.length,c/a.length]},c=b(a),d=0;d<a.length;d++)a[d][2]=Math.atan2(a[d][0]-c[0],a[d][1]-c[1]);a=a.sort(function(a,b){return a[2]-b[2]});var e=[];if(a.forEach(function(a){e.indexOf(a)<0&&e.push(a)}),e.length>0){e[e.length-1][0]===e[0][0]&&e[e.length-1][1]===e[0][1]||e.push([e[0][0],e[0][1]]);for(var f=0;f<e.length;f++)e[f]=[e[f][0],e[f][1]]}return e}};
