var CanvasControl=function(){defaultBackgroundObject={backgroundColor:"#000000"};var l=0;this.defaultColor="#000000",this.defaultLineWidth="1",this.canvasContext=null,this.canvasObject=null,this.canvasObjects=[],Math.TAU=2*Math.PI,this.setupCanvas=function(t,e,i){return e=void 0===e||null==e?this.canvasObjects:e,i&&(defaultBackgroundObject=i),this.canvasObject=t,e=[],e.push(),this.canvasObjects=e,this.canvasContext=t.getContext("2d"),1&l&&(console.log("[1]: Debug Mode is set to: ",l),console.log("[1]: setupCanvas(objCanvas, objectList): ",t,e)),this.canvasContext},this.renderObjects=function(t){t=void 0===t||null==t?this.canvasObjects:t;for(canvasObject in t)void 0!==t[canvasObject].visible&&null!=t[canvasObject].visible&&0!=t[canvasObject].visible&&t[canvasObject].render(t[canvasObject]);return 2&l&&console.log("[2]: renderObjects(objectList): ",t),!0},this.drawRect=function(t,e,i,o,n,s,d){s=void 0===s||null==s?this.canvasContext:s,t=void 0===t||null==t||""==t?0:t,e=void 0===e||null==e||""==e?0:e,i=void 0===i||null==i||""==i?0:i,o=void 0===o||null==o||""==o?0:o,originalFillStyle=s.fillStyle,originalStrokeStyle=s.strokeStyle,void 0!==d&&null!=d&&(d.fillStyle=void 0===d.fillStyle?this.defaultColor:d.fillStyle,d.strokeStyle=void 0===d.strokeStyle?this.defaultColor:d.strokeStyle,d.lineWidth=void 0===d.lineWidth?this.defaultLineWidth:d.lineWidth),n=void 0===n||null==n?function(){s.stroke()}:n,void 0!==d&&null!=d&&(s.fillStyle=void 0===d.fillStyle||null==d.fillStyle?s.fillStyle:d.fillStyle,s.strokeStyle=void 0===d.strokeStyle||null==d.strokeStyle?s.strokeStyle:d.strokeStyle,s.lineWidth=void 0===d.lineWidth||null==d.lineWidth?s.lineWidth:d.lineWidth),s.beginPath(),s.rect(t,e,i,o),n(),s.closePath(),s.fillStyle=originalFillStyle,s.strokeStyle=originalStrokeStyle,4&l&&console.log("[4]: drawRect(x, y, w, h, renderType, context, style): ",t,e,i,o,n,s,d)},this.drawText=function(t,e,i,o,n,s,d){s=void 0===s||null==s?this.canvasContext:s,t=void 0===t||null==t||""==t?0:t,e=void 0===e||null==e||""==e?0:e,o.w=void 0===o.w||null==o.w||""==o.w?s.measureText(i).width:o.w,o.h=void 0===o.h||null==o.h||""==o.h?s.measureText(i).height:o.h,originalFillStyle=s.fillStyle,originalStrokeStyle=s.strokeStyle,void 0!==d&&null!=d?(s.fillStyle=void 0===d.fillStyle||null==d.fillStyle?s.fillStyle:d.fillStyle,s.strokeStyle=void 0===d.strokeStyle||null==d.strokeStyle?s.strokeStyle:d.strokeStyle,d.textBaseline=void 0===d.textBaseline?"hanging":d.textBaseline,d.font=void 0===d.font?"":d.font,d.maxWidth=void 0===d.maxWidth?null:d.maxWidth):d={},n=void 0===n||null==n?function(l,t,e,i){s.fillText(e,l,t)}:n,void 0!==d&&null!=d&&(s.fillStyle=void 0===d.fillStyle||null==d.fillStyle?s.fillStyle:d.fillStyle,s.strokeStyle=void 0===d.strokeStyle||null==d.strokeStyle?s.strokeStyle:d.strokeStyle,s.textBaseline=void 0===d.textBaseline?s.textBaseline:d.textBaseline,s.font=void 0===d.font?s.font:d.font,d.maxWidth=void 0===d.maxWidth?s.maxWidth:d.maxWidth),s.beginPath(),n(t,e,i,d.maxWidth),s.closePath(),s.fillStyle=originalFillStyle,s.strokeStyle=originalStrokeStyle,8&l&&console.log("[8]: drawText(x, y, text, renderText, context, style): ",t,e,i,n,s,d)},this.drawArc=function(t,e,i,o,n,s,d,a){d=void 0===d||null==d?this.canvasContext:d,t=void 0===t||null==t||""==t?0:t,e=void 0===e||null==e||""==e?0:e,o=void 0===o||null==o||""==o?0:o,i=void 0===i||null==i||""==i?0:i,n=void 0===n||null==n||""==n?2*Math.TAU:n,originalFillStyle=d.fillStyle,originalStrokeStyle=d.strokeStyle,void 0!==a&&null!=a&&(a.fillStyle=void 0===a.fillStyle?this.defaultColor:a.fillStyle,a.strokeStyle=void 0===a.strokeStyle?this.defaultColor:a.strokeStyle,a.lineWidth=void 0===a.lineWidth?this.defaultLineWidth:a.lineWidth),s=void 0===s||null==s?function(){d.stroke()}:s,void 0!==a&&null!=a&&(d.fillStyle=void 0===a.fillStyle||null==a.fillStyle?d.fillStyle:a.fillStyle,d.strokeStyle=void 0===a.strokeStyle||null==a.strokeStyle?d.strokeStyle:a.strokeStyle,d.lineWidth=void 0===a.lineWidth||null==a.lineWidth?d.lineWidth:a.lineWidth),d.beginPath(),d.arc(t,e,i,o,n),s(),d.closePath(),d.fillStyle=originalFillStyle,d.strokeStyle=originalStrokeStyle,16&l&&console.log("[16]: drawArc(x, y, r, s, f, renderType, context, style): ",t,e,i,o,n,s,d,a)},this.drawLine=function(t,e,i,o,n,s){n=void 0===n||null==n?this.canvasContext:n,t=void 0===t||null==t||""==t?0:t,e=void 0===e||null==e||""==e?0:e,i=void 0===i||null==i||""==i?0:i,o=void 0===o||null==o||""==o?0:o,originalFillStyle=n.fillStyle,originalStrokeStyle=n.strokeStyle,void 0!==s&&null!=s&&(s.strokeStyle=void 0===s.strokeStyle?this.defaultColor:s.strokeStyle,s.lineWidth=void 0===s.lineWidth?this.defaultLineWidth:s.lineWidth),void 0!==s&&null!=s&&(n.strokeStyle=void 0===s.strokeStyle||null==s.strokeStyle?n.strokeStyle:s.strokeStyle,n.lineWidth=void 0===s.lineWidth||null==s.lineWidth?n.lineWidth:s.lineWidth),n.beginPath(),n.moveTo(t,e),n.lineTo(i,o),n.stroke(),n.closePath(),n.fillStyle=originalFillStyle,n.strokeStyle=originalStrokeStyle,32&l&&console.log("[32]: drawLine(x1, y1, x2, y2, context, style): ",t,e,i,o,n,s)},this.drawPolygon=function(e,i,o,n,s){if(n=void 0===n||null==n?this.canvasContext:n,i=void 0===i||null==i||""==i?!0:i,originalFillStyle=n.fillStyle,originalStrokeStyle=n.strokeStyle,void 0!==s&&null!=s&&(s.fillStyle=void 0===s.fillStyle?this.defaultColor:s.fillStyle,s.strokeStyle=void 0===s.strokeStyle?this.defaultColor:s.strokeStyle,s.lineWidth=void 0===s.lineWidth?this.defaultLineWidth:s.lineWidth),o=void 0===o||null==o?function(){n.stroke()}:o,void 0!==s&&null!=s&&(n.fillStyle=void 0===s.fillStyle||null==s.fillStyle?n.fillStyle:s.fillStyle,n.strokeStyle=void 0===s.strokeStyle||null==s.strokeStyle?n.strokeStyle:s.strokeStyle,n.lineWidth=void 0===s.lineWidth||null==s.lineWidth?n.lineWidth:s.lineWidth),i&&(e=t(e)),n.beginPath(),e.length>0){n.moveTo(e[0][0],e[0][1]);for(var d=1;d<e.length;d++)n.lineTo(e[d][0],e[d][1])}n.closePath(),o(),n.fillStyle=originalFillStyle,n.strokeStyle=originalStrokeStyle,64&l&&console.log("[64]: drawPolygon(polygonPoints, autoArrange, renderType, context, style): ",e,i,o,n,s)},this.drawImage=function(t,e,i,o,n,s,d,a,r,c){c=void 0===c||null==c?this.canvasContext:c,e=void 0===e||null==e||""==e?0:e,i=void 0===i||null==i||""==i?0:i,o=void 0===o?t.width:o,n=void 0===n?t.height:n,s=void 0===n?null:s,d=void 0===n?null:d,a=void 0===n?null:a,r=void 0===n?null:r,originalFillStyle=c.fillStyle,t.objImage&&(t.w=t.w<0?t.objImage.width:t.w,t.h=t.h<0?t.objImage.height:t.h,c.beginPath(),null==s||null==d||null==a||null==r||0==s||0==d||0==a||0==r?0>o||0>n?c.drawImage(t.objImage,e,i):c.drawImage(t.objImage,e,i,o,n):c.drawImage(t.objImage,s,d,a,r,e,i,o,n),c.closePath(),t.onload=function(){t.hasLoaded=!0,t.w=t.w<0?t.objImage.width:t.w,t.h=t.h<0?t.objImage.height:t.h,c.beginPath(),null==s||null==d||null==a||null==r||0==s||0==d||0==a||0==r?0>o||0>n?c.drawImage(t.objImage,e,i):c.drawImage(t.objImage,e,i,o,n):c.drawImage(t.objImage,s,d,a,r,e,i,o,n),c.closePath()}),c.fillStyle=originalFillStyle,128&l&&console.log("[128]: drawImage(srcImage, x, y, w, h, sx, sy, sw, sh, context): ",t,e,i,o,n,s,d,a,r,c)},this.clearCanvas=function(t,e,i){e=void 0===e||null==e?this.canvasContext:e,i=void 0===i||null==i?!0:i,originalFillStyle=e.fillStyle,t=void 0!==defaultBackgroundObject&&null!=defaultBackgroundObject?void 0===t||null==t?defaultBackgroundObject.backgroundColor:t:void 0===t||null==t?"#FFFFFF":t,i?e.clearRect(0,0,this.canvasObject.width,this.canvasObject.height):this.drawRect(0,0,this.canvasObject.width,this.canvasObject.height,function(){e.fill()},e,{fillStyle:t}),e.fillStyle=originalFillStyle,256&l&&console.log("[256]: clearCanvas(backgroundColor, context, transparentBackground): ",t,e,i)},this.refreshScreen=function(t,e,i){e=void 0===e||null==e?this.canvasContext:e,i=void 0===i||null==i?this.canvasObjects:i,this.clearCanvas(null,e,t),this.renderObjects(i),512&l&&console.log("[512]: refreshScreen(transparentBackground, context, objectList): ",t,e,i)},this.mouseEventHandler=function(t,e,i){i=void 0===i||null==i?this.canvasObjects:i;triggedObjectList=this.checkMouseCollision(t.offsetX,t.offsetY);for(var o in triggedObjectList)null!=triggedObjectList[o]&&("Click"==e?void 0!==triggedObjectList[o].clickEvent&&null!=triggedObjectList[o].clickEvent&&(void 0!==triggedObjectList[o].enabled&&null!=triggedObjectList[o].enabled?1==triggedObjectList[o].enabled&&triggedObjectList[o].clickEvent(t.offsetX,t.offsetY,triggedObjectList[o]):triggedObjectList[o].clickEvent(t.offsetX,t.offsetY,triggedObjectList[o])):"Move"==e&&void 0!==triggedObjectList[o].moveEvent&&null!=triggedObjectList[o].moveEvent&&(void 0!==triggedObjectList[o].enabled&&null!=triggedObjectList[o].enabled?1==triggedObjectList[o].enabled&&triggedObjectList[o].moveEvent(t.offsetX,t.offsetY,triggedObjectList[o]):triggedObjectList[o].moveEvent(t.offsetX,t.offsetY,triggedObjectList[o])));1024&l&&console.log("[1024]: mouseEventHandler(e, eventType, objectList): ",t,e,i)},this.checkMouseCollision=function(t,e,i){i=void 0===i||null==i?this.canvasObjects:i,clickedObjects=[];for(var o in i)if(null!=i[o]&&void 0!==typeof i[o]&&null!=i[o].shape&&void 0!==typeof i[o].shape)if("rect"==i[o].shape)void 0!==i[o].x&&null!=i[o].x&&void 0!==i[o].w&&null!=i[o].w&&void 0!==i[o].y&&null!=i[o].y&&void 0!==i[o].h&&null!=i[o].h&&i[o].x<=t&&i[o].x+i[o].w>=t&&i[o].y<=e&&i[o].y+i[o].h>=e&&clickedObjects.push(i[o]);else if("arc"==i[o].shape)void 0!==i[o].x&&null!=i[o].x&&void 0!==i[o].y&&null!=i[o].y&&void 0!==i[o].r&&null!=i[o].r&&Math.sqrt((t-i[o].x)*(t-i[o].x)+(e-i[o].y)*(e-i[o].y))<i[o].r&&clickedObjects.push(i[o]);else if("image"==i[o].shape)void 0!==i[o].x&&null!=i[o].x&&void 0!==i[o].w&&null!=i[o].w&&void 0!==i[o].y&&null!=i[o].y&&void 0!==i[o].h&&null!=i[o].h&&i[o].x<=t&&i[o].x+i[o].w>=t&&i[o].y<=e&&i[o].y+i[o].h>=e&&clickedObjects.push(i[o]);else if("text"==i[o].shape)void 0!==i[o].x&&null!=i[o].x&&void 0!==i[o].w&&null!=i[o].w&&void 0!==i[o].y&&null!=i[o].y&&void 0!==i[o].h&&null!=i[o].h&&i[o].x<=t&&i[o].x+i[o].w>=t&&i[o].y<=e&&i[o].y+i[o].h>=e&&clickedObjects.push(i[o]);else if("polygon"==i[o].shape){for(var n=i[o].coordinates[0],s=!1,d=0,a=n.length-1;d<n.length;a=d++){var r=n[d][0],c=n[d][1],h=n[a][0],u=n[a][1],v=c>e!=u>e&&(h-r)*(e-c)/(u-c)+r>t;v&&(s=!s)}s&&clickedObjects.push(i[o])}return 2048&l&&console.log("[2048]: checkMouseCollision(mouseX, mouseY, objectList): ",t,e,i),clickedObjects};var t=function(l){l=l.slice(0);for(var t=function(l){for(var t=0,e=0,i=0;i<l.length;i++)t+=l[i][0],e+=l[i][1];return[t/l.length,e/l.length]},e=t(l),i=0;i<l.length;i++)l[i][2]=Math.atan2(l[i][0]-e[0],l[i][1]-e[1]);l=l.sort(function(l,t){return l[2]-t[2]});var o=[];if(l.forEach(function(l){o.indexOf(l)<0&&o.push(l)}),o.length>0){(o[o.length-1][0]!==o[0][0]||o[o.length-1][1]!==o[0][1])&&o.push([o[0][0],o[0][1]]);for(var n=0;n<o.length;n++)o[n]=[o[n][0],o[n][1]]}return o}};
