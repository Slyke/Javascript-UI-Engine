var CanvasControl=function(){defaultBackgroundObject={backgroundColor:"#FFFFFF"},debugConsole=511,canvasContext=null,canvasObject=null,canvasObjects=[],Math.TAU=2*Math.PI,this.setupCanvas=function(l,e){return e=void 0===e||null==e?this.canvasObjects:e,this.canvasObject=l,e=[],e.push(),this.canvasObjects=e,this.canvasContext=l.getContext("2d"),1&debugConsole&&console.log("setupCanvas(objCanvas, objectList): ",l,e),this.canvasContext},this.renderObjects=function(l){l=void 0===l||null==l?this.canvasObjects:l,this.clearCanvas();for(canvasObject in l)void 0!==l[canvasObject].visible&&null!=l[canvasObject].visible&&0!=l[canvasObject].visible&&l[canvasObject].render(l[canvasObject]);return 2&debugConsole&&console.log("renderObjects(objectList): ",l),!0},this.drawSquare=function(l,e,t,i,o,n,s){n=void 0===n||null==n?this.canvasContext:n,l=void 0===l||null==l||""==l?0:l,e=void 0===e||null==e||""==e?0:e,t=void 0===t||null==t||""==t?0:t,i=void 0===i||null==i||""==i?0:i,originalFillStyle=n.fillStyle,void 0!==s&&null!=s&&(s.fillStyle=void 0===s.fillStyle?"000000":s.fillStyle,s.strokeStyle=void 0===s.strokeStyle?"000000":s.strokeStyle,s.lineWidth=void 0===s.lineWidth?"1":s.lineWidth),o=void 0===o||null==o?function(){n.stroke()}:o,void 0!==s&&null!=s&&(n.fillStyle=void 0===s.fillStyle||null==s.fillStyle?n.fillStyle:s.fillStyle,n.strokeStyle=void 0===s.strokeStyle||null==s.strokeStyle?n.strokeStyle:s.strokeStyle,n.lineWidth=void 0===s.lineWidth||null==s.lineWidth?n.lineWidth:s.lineWidth),n.beginPath(),n.rect(l,e,t,i),o(),n.closePath(),n.fillStyle=originalFillStyle,4&debugConsole&&console.log("drawSquare(x, y, w, h, renderType, context, style): ",l,e,t,i,o,n,s)},this.drawText=function(l,e,t,i,o,n,s){n=void 0===n||null==n?this.canvasContext:n,l=void 0===l||null==l||""==l?0:l,e=void 0===e||null==e||""==e?0:e,i.w=void 0===i.w||null==i.w||""==i.w?n.measureText(t).width:i.w,i.h=void 0===i.h||null==i.h||""==i.h?n.measureText(t).height:i.h,originalFillStyle=n.fillStyle,void 0!==s&&null!=s?(n.fillStyle=void 0===s.fillStyle||null==s.fillStyle?n.fillStyle:s.fillStyle,n.strokeStyle=void 0===s.strokeStyle||null==s.strokeStyle?n.strokeStyle:s.strokeStyle,s.textBaseline=void 0===s.textBaseline?"hanging":s.textBaseline,s.font=void 0===s.font?"":s.font,s.maxWidth=void 0===s.maxWidth?null:s.maxWidth):s={},o=void 0===o||null==o?function(l,e,t){n.fillText(t,l,e)}:o,void 0!==s&&null!=s&&(n.fillStyle=void 0===s.fillStyle||null==s.fillStyle?n.fillStyle:s.fillStyle,n.strokeStyle=void 0===s.strokeStyle||null==s.strokeStyle?n.strokeStyle:s.strokeStyle,n.textBaseline=void 0===s.textBaseline?n.textBaseline:s.textBaseline,n.font=void 0===s.font?n.font:s.font,s.maxWidth=void 0===s.maxWidth?n.maxWidth:s.maxWidth),n.beginPath(),o(l,e,t,s.maxWidth),n.closePath(),n.fillStyle=originalFillStyle,8&debugConsole&&console.log("drawText(x, y, text, renderText, context, style): ",l,e,t,o,n,s)},this.drawArc=function(l,e,t,i,o,n,s,d){s=void 0===s||null==s?this.canvasContext:s,l=void 0===l||null==l||""==l?0:l,e=void 0===e||null==e||""==e?0:e,i=void 0===i||null==i||""==i?0:i,t=void 0===t||null==t||""==t?0:t,o=void 0===o||null==o||""==o?2*Math.PI:o,originalFillStyle=s.fillStyle,void 0!==d&&null!=d&&(d.fillStyle=void 0===d.fillStyle?"000000":d.fillStyle,d.strokeStyle=void 0===d.strokeStyle?"000000":d.strokeStyle,d.lineWidth=void 0===d.lineWidth?"1":d.lineWidth),n=void 0===n||null==n?function(){s.stroke()}:n,void 0!==d&&null!=d&&(s.fillStyle=void 0===d.fillStyle||null==d.fillStyle?s.fillStyle:d.fillStyle,s.strokeStyle=void 0===d.strokeStyle||null==d.strokeStyle?s.strokeStyle:d.strokeStyle,s.lineWidth=void 0===d.lineWidth||null==d.lineWidth?s.lineWidth:d.lineWidth),s.beginPath(),s.arc(l,e,t,i,o),n(),s.closePath(),s.fillStyle=originalFillStyle,16&debugConsole&&console.log("drawArc(x, y, r, s, f, renderType, context, style): ",l,e,t,i,o,n,s,d)},this.drawLine=function(l,e,t,i,o,n){o=void 0===o||null==o?this.canvasContext:o,l=void 0===l||null==l||""==l?0:l,e=void 0===e||null==e||""==e?0:e,t=void 0===t||null==t||""==t?0:t,i=void 0===i||null==i||""==i?0:i,originalFillStyle=o.fillStyle,void 0!==n&&null!=n&&(n.strokeStyle=void 0===n.strokeStyle?"000000":n.strokeStyle,n.lineWidth=void 0===n.lineWidth?"1":n.lineWidth),void 0!==n&&null!=n&&(o.strokeStyle=void 0===n.strokeStyle||null==n.strokeStyle?o.strokeStyle:n.strokeStyle,o.lineWidth=void 0===n.lineWidth||null==n.lineWidth?o.lineWidth:n.lineWidth),o.beginPath(),o.moveTo(l,e),o.lineTo(t,i),o.stroke(),o.closePath(),o.fillStyle=originalFillStyle,32&debugConsole&&console.log("drawLine(x1, y1, x2, y2, context, style): ",l,e,t,i,o,n)},this.drawPolygon=function(e,t,i,o,n){o=void 0===o||null==o?this.canvasContext:o,x1=void 0===x1||null==x1||""==x1?0:x1,y1=void 0===y1||null==y1||""==y1?0:y1,x2=void 0===x2||null==x2||""==x2?0:x2,y2=void 0===y2||null==y2||""==y2?0:y2,t=void 0===t||null==t||""==t?!0:t,originalFillStyle=o.fillStyle,void 0!==n&&null!=n&&(n.fillStyle=void 0===n.fillStyle?"000000":n.fillStyle,n.strokeStyle=void 0===n.strokeStyle?"000000":n.strokeStyle,n.lineWidth=void 0===n.lineWidth?"1":n.lineWidth),i=void 0===i||null==i?function(){o.stroke()}:i,void 0!==n&&null!=n&&(o.fillStyle=void 0===n.fillStyle||null==n.fillStyle?o.fillStyle:n.fillStyle,o.strokeStyle=void 0===n.strokeStyle||null==n.strokeStyle?o.strokeStyle:n.strokeStyle,o.lineWidth=void 0===n.lineWidth||null==n.lineWidth?o.lineWidth:n.lineWidth),t&&(e=l(e)),o.beginPath(),o.moveTo(e[0][0],e[0][1]);for(var s=1;e>s;s++)o.lineTo(e[s][0],e[s][0]);o.closePath(),o.fillStyle=originalFillStyle,32&debugConsole&&console.log("drawLine(x1, y1, x2, y2, renderType, context, style): ",x1,y1,x2,y2,i,o,n)},this.drawImage=function(l,e,t,i,o,n,s,d,a,c){c=void 0===c||null==c?this.canvasContext:c,e=void 0===e||null==e||""==e?0:e,t=void 0===t||null==t||""==t?0:t,i=void 0===i?l.width:i,o=void 0===o?l.height:o,n=void 0===o?null:n,s=void 0===o?null:s,d=void 0===o?null:d,a=void 0===o?null:a,originalFillStyle=c.fillStyle,l.objImage.onload=function(){l.w=l.w<=0?l.objImage.width:l.w,l.h=l.h<=0?l.objImage.height:l.h,c.beginPath(),null==n&&null==s&&null==d&&null==a?c.drawImage(l.objImage,e,t):c.drawImage(l.objImage,n,s,d,a,e,t,i,o),c.closePath()},c.fillStyle=originalFillStyle,64&debugConsole&&console.log("drawImage(srcImage, x, y, w, h, sx, sy, sw, sh, context): ",l,e,t,i,o,n,s,d,a,c)},this.clearCanvas=function(l,e){e=void 0===e||null==e?this.canvasContext:e,originalFillStyle=e.fillStyle,l=void 0!==defaultBackgroundObject&&null!=defaultBackgroundObject?void 0===l||null==l?defaultBackgroundObject.backgroundColor:l:void 0===l||null==l?"#FFFFFF":l,this.drawSquare(0,0,this.canvasObject.width,this.canvasObject.height,function(){e.fill()},e,{fillStyle:defaultBackgroundObject.backgroundColor}),e.fillStyle=originalFillStyle,console.log("Cleared Canvas: ",this.canvasObject.width,this.canvasObject.height),128&debugConsole&&console.log("clearCanvas(backgroundColor, context): ",l,e)},this.refreshScreen=function(l,e){l=void 0===l||null==l?this.canvasContext:l,e=void 0===e||null==e?this.canvasObjects:e,this.clearCanvas(l),this.renderObjects(e),256&debugConsole&&console.log("refreshScreen(context, objectList): ",l,e)},this.mouseEventHandler=function(l,e,t){t=void 0===t||null==t?this.canvasObjects:t;triggedObjectList=this.checkMouseCollision(l.offsetX,l.offsetY);for(var i in triggedObjectList)null!=triggedObjectList[i]&&("Click"==e?void 0!==triggedObjectList[i].clickEvent&&null!=triggedObjectList[i].clickEvent&&(void 0!==triggedObjectList[i].enabled&&null!=triggedObjectList[i].enabled?1==triggedObjectList[i].enabled&&triggedObjectList[i].clickEvent(l.offsetX,l.offsetY,triggedObjectList[i]):triggedObjectList[i].clickEvent(l.offsetX,l.offsetY,triggedObjectList[i])):"Move"==e&&void 0!==triggedObjectList[i].moveEvent&&null!=triggedObjectList[i].moveEvent&&(void 0!==triggedObjectList[i].enabled&&null!=triggedObjectList[i].enabled?1==triggedObjectList[i].enabled&&triggedObjectList[i].moveEvent(l.offsetX,l.offsetY,triggedObjectList[i]):triggedObjectList[i].moveEvent(l.offsetX,l.offsetY,triggedObjectList[i])));512&debugConsole&&console.log("mouseEventHandler(e, eventType, objectList): ",l,e,t)},this.checkMouseCollision=function(l,e,t){t=void 0===t||null==t?this.canvasObjects:t,clickedObjects=[];for(var i in t)if(null!=t[i]&&void 0!==typeof t[i]&&null!=t[i].shape&&void 0!==typeof t[i].shape)if("rect"==t[i].shape)void 0!==t[i].x&&null!=t[i].x&&void 0!==t[i].w&&null!=t[i].w&&void 0!==t[i].y&&null!=t[i].y&&void 0!==t[i].h&&null!=t[i].h&&t[i].x<=l&&t[i].x+t[i].w>=l&&t[i].y<=e&&t[i].y+t[i].h>=e&&clickedObjects.push(t[i]);else if("arc"==t[i].shape)void 0!==t[i].x&&null!=t[i].x&&void 0!==t[i].y&&null!=t[i].y&&void 0!==t[i].r&&null!=t[i].r&&Math.sqrt((l-t[i].x)*(l-t[i].x)+(e-t[i].y)*(e-t[i].y))<t[i].r&&clickedObjects.push(t[i]);else if("image"==t[i].shape)void 0!==t[i].x&&null!=t[i].x&&void 0!==t[i].w&&null!=t[i].w&&void 0!==t[i].y&&null!=t[i].y&&void 0!==t[i].h&&null!=t[i].h&&t[i].x<=l&&t[i].x+t[i].w>=l&&t[i].y<=e&&t[i].y+t[i].h>=e&&clickedObjects.push(t[i]);else if("text"==t[i].shape)void 0!==t[i].x&&null!=t[i].x&&void 0!==t[i].w&&null!=t[i].w&&void 0!==t[i].y&&null!=t[i].y&&void 0!==t[i].h&&null!=t[i].h&&t[i].x<=l&&t[i].x+t[i].w>=l&&t[i].y<=e&&t[i].y+t[i].h>=e&&clickedObjects.push(t[i]);else if("polygon"==t[i].shape){for(var o=!1,n=0,s=vs.length-1;n<vs.length;s=n++){var d=vs[n][0],a=vs[n][1],c=vs[s][0],v=vs[s][1],r=a>y!=v>y&&(c-d)*(y-a)/(v-a)+d>x;r&&(o=!o)}o&&clickedObjects.push(t[i])}return 1024&debugConsole&&console.log("checkMouseCollision(mouseX, mouseY, objectList): ",l,e,t),clickedObjects};var l=function(l){l=l.slice(0);for(var e=function(l){for(var e=0,t=0,i=0;i<l.length;i++)e+=l[i][0],t+=l[i][1];return[e/l.length,t/l.length]},t=e(l),i=0;i<l.length;i++)l[i][2]=Math.atan2(l[i][0]-t[0],l[i][1]-t[1]);return l=l.sort(function(l,e){return l[2]-e[2]})}};